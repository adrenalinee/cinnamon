<!DOCTYPE html>

<html
	ng-app="cinnamon"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="configuration/layout/base">

<head>
<title>비밀번호 찾기</title>
<link href="/css/cinnamon.css" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="/js/cinnamon.js"></script>
<script type="text/javascript">
angular.module('cinnamon')
.controller('configuration.findPassword', function($scope, $http, $interval, $state, $mdToast, $mdDialog, $mdMedia) {
	console.log('configuration.users.create');
	
	$scope.create = function(form, event) {
		console.log('create');
		
		if (form.$valid == false ||
			$scope.domain.password != $scope.domain.password2) {
			
			$mdToast.show(
				$mdToast.simple()
					.textContent('입력값을 확인하시기 바랍니다.'));
			return;
		}
		
		$scope.isProcess = true;
		$http.head('/rest/configuration/users/' + $scope.domain.userId)
		.success(function(data, status) {
			$mdToast.show(
					$mdToast.simple()
					.position('top right')
					.textContent('이미 사용중인 아이디 입니다. 다른 아이디를 입력하시기 바랍니다.'));
			$scope.isProcess = false;
		}).error(function(data, status) {
			if (status == 404) {
				$scope.isProcess = true;
				$http.post('/rest/configuration/users', $scope.domain)
				.success(function(data, status, config) {
					console.log(status);
					
					$mdDialog.hide()
					.then(function() {
						$state.go('view', {userId: $scope.domain.userId});
					});
				});
			}
		});
		
	}
	
	$scope.goBack = function() {
		history.go(-1);
	}
	
});
</script>
<base href="/" />
</head>
<body layout:fragment="body" layout-gt-xs="row" layout-align-gt-xs="center start" class="content">

	<md-content flex-gt-xs="30" class="content" ng-controller="configuration.findPassword">
		
		<div layout-align="center center" layout="row">
			<h2 class="md-headline">
				<a href="/" target="_self">welcom to Cinnamon</a>
			</h2>
		</div>
		
		<md-card layout-padding="">
			<md-card-header>
				<md-card-header-text>
					<span class="md-title">비밀번호 찾기</span>
				</md-card-header-text>
			</md-card-header>
			
			<p class="alert-info"  layout-margin="" layout-padding="">
				회원가입시 등록한 이메일 주소로 비밀번호 초기화 링크를 전달해 드립니다.
			</p>
			<md-card-content>
				<form name="firstUserform" novalidate="novalidate" layout-padding="">

					<md-input-container class="md-block">
						<label>이메일</label>
						<input type="email" name="email" ng-model="domain.email" required="required" md-maxlength="200" maxlength="200" />
						<div ng-messages="firstUserform.email.$submitted">
							<div ng-message="required" ng-show="firstUserform.email.$error.required">필수 입력 항목입니다.</div>
							<div ng-message="email" ng-show="firstUserform.email.$error.email">이메일 형식을 입력하시기 바랍니다.</div>
						</div>
					</md-input-container>

				</form>
				
				
			</md-card-content>
			<md-button type="submit" class="md-raised md-primary">비밀번호 초기화 이메일 발송</md-button>
		</md-card>
		
	</md-content>
</body>
</html>